<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Robin &amp; the Realms of Light Trailer</title>
  <style>
    body {
      background: #121212;
      color: #EEE;
      font-family: sans-serif;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 40px 0;
    }

    #player {
      width: 640px;
      position: relative;
    }

    /* Title */
    #title {
      text-align: center;
      font-size: 1.4rem;
      margin-bottom: 12px;
    }

    video {
      width: 100%;
      background: #000;
      display: block;
    }

    /* Controls */
    #controls {
      margin-top: 12px;
      user-select: none;
    }

    #time-progress {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .time-label {
      width: 50px;
      text-align: center;
      font-size: 0.9rem;
    }

    #progress-container {
      position: relative;
      flex: 1;
      height: 8px;
      background: #E0E0E0;
      border-radius: 4px;
      cursor: pointer;
    }

    #progress-bar {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 0%;
      background: #2196F3;
      border-radius: 4px;
    }

    #progress-knob {
      position: absolute;
      top: 50%;
      left: 0%;
      width: 16px;
      height: 16px;
      background: #FF5722;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      cursor: pointer;
    }

    /* End‐of‐Video Overlay */
    #overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.9);
      color: #FFF;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }

    #overlay button {
      margin: 8px;
      padding: 12px 24px;
      font-size: 1rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: #2196F3;
      color: #FFF;
    }

    /* Error Overlay */
    #error-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.9);
      color: #FFF;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 20;
      text-align: center;
      padding: 0 20px;
    }

    #error-overlay h2 {
      margin-bottom: 12px;
    }

    #error-overlay p {
      margin-bottom: 20px;
    }

    #error-exit {
      padding: 12px 24px;
      font-size: 1rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: #2196F3;
      color: #FFF;
    }
  </style>
</head>
<body>
  <div id="player">
    <div id="title">Robin &amp; the Realms of Light Trailer</div>
    <video id="video" controlsList="nodownload" disablepictureinpicture></video>
    <div id="controls">
      <div id="time-progress">
        <span id="current-time" class="time-label">0:00</span>
        <div id="progress-container">
          <div id="progress-bar"></div>
          <div id="progress-knob"></div>
        </div>
        <span id="duration" class="time-label">0:00</span>
      </div>
    </div>
  </div>

  <div id="overlay">
    <h2>The Trailer Has Ended</h2>
    <button id="watch-again">Watch Again</button>
    <button id="exit-video">Exit Trailer</button>
    <button id="watch-movie">Watch Movie</button>
  </div>

  <div id="error-overlay">
    <h2>Error Loading Video</h2>
    <p>There was an error and you cannot watch the video.</p>
    <button id="error-exit">Go Back</button>
  </div>

  <script>
    (function() {
      // Configure your links here
      const links = {
        watchAgain: '', 
        exit: 'https://camcookie876.github.io/TV/movies/1/',
        movie: ''
      };

      const segments = ['segment1.mp4', 'segment2.mp4', 'segment3.mp4'];
      const maxRetries = 3;
      const attempts = segments.map(() => 0);

      // Elements
      const video = document.getElementById('video');
      const overlay = document.getElementById('overlay');
      const errorOverlay = document.getElementById('error-overlay');
      const btnAgain = document.getElementById('watch-again');
      const btnExit = document.getElementById('exit-video');
      const btnMovie = document.getElementById('watch-movie');
      const btnErrorExit = document.getElementById('error-exit');

      const currentTimeLabel = document.getElementById('current-time');
      const durationLabel    = document.getElementById('duration');
      const progressBar      = document.getElementById('progress-bar');
      const progressKnob     = document.getElementById('progress-knob');
      const progressContainer= document.getElementById('progress-container');

      // Hide buttons without links
      if (!links.watchAgain) btnAgain.style.display = 'none';
      if (!links.exit)       btnExit.style.display  = 'none';
      if (!links.movie)      btnMovie.style.display = 'none';

      // format H:MM:SS or M:SS
      function formatTime(sec) {
        const s = Math.floor(sec % 60).toString().padStart(2,'0');
        const m = Math.floor((sec/60) % 60).toString().padStart(2,'0');
        const h = Math.floor(sec/3600);
        return h > 0 ? `${h}:${m}:${s}` : `${m}:${s}`;
      }

      // Show error overlay
      function showError() {
        video.pause();
        errorOverlay.style.display = 'flex';
      }

      // Seamless segment loading with retry logic
      if (!window.MediaSource) {
        return showError();
      }
      const mediaSource = new MediaSource();
      video.src = URL.createObjectURL(mediaSource);

      mediaSource.addEventListener('sourceopen', () => {
        URL.revokeObjectURL(video.src);
        const sb = mediaSource.addSourceBuffer('video/mp4; codecs="avc1.640028, mp4a.40.2"');
        let index = 0;

        function fetchSegment() {
          if (index >= segments.length) {
            mediaSource.endOfStream();
            return;
          }
          attempts[index]++;
          fetch(segments[index]).then(r => {
            if (!r.ok) throw new Error('Fetch failed');
            return r.arrayBuffer();
          }).then(buf => {
            sb.appendBuffer(buf);
            index++;
          }).catch(() => {
            if (attempts[index] < maxRetries) {
              fetchSegment();
            } else {
              showError();
            }
          });
        }

        sb.addEventListener('updateend', fetchSegment);
        fetchSegment();
      });

      // Update duration & progress
      video.addEventListener('loadedmetadata', () => {
        durationLabel.textContent = formatTime(video.duration);
      });

      video.addEventListener('timeupdate', () => {
        const pct = (video.currentTime / video.duration) * 100;
        progressBar.style.width = pct + '%';
        progressKnob.style.left = pct + '%';
        currentTimeLabel.textContent = formatTime(video.currentTime);
      });

      // Seek by click/drag
      progressContainer.addEventListener('click', e => {
        const rect = progressContainer.getBoundingClientRect();
        video.currentTime = ((e.clientX - rect.left) / rect.width) * video.duration;
      });
      let dragging = false;
      progressKnob.addEventListener('mousedown', () => dragging = true);
      document.addEventListener('mouseup', () => dragging = false);
      document.addEventListener('mousemove', e => {
        if (!dragging) return;
        const rect = progressContainer.getBoundingClientRect();
        let x = e.clientX - rect.left;
        x = Math.max(0, Math.min(x, rect.width));
        video.currentTime = (x / rect.width) * video.duration;
      });

      // End‐of‐video overlay
      video.addEventListener('ended', () => {
        overlay.style.display = 'flex';
      });

      // Button actions
      if (links.watchAgain) btnAgain.onclick = () => {
        overlay.style.display = 'none';
        video.currentTime = 0;
        video.play();
      };
      if (links.exit) btnExit.onclick = () => location.href = links.exit;
      if (links.movie) btnMovie.onclick = () => location.href = links.movie;
      btnErrorExit.onclick = () => location.href = links.exit;
    })();
  </script>
</body>
</html>